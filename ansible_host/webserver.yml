---
- name: Konfiguracja webservera
  vars_files: 
    - vars/webserver_vars.yml
  
  hosts: '{{ server_name }}_group'
  become: true
  ignore_errors: true

  tasks:   

    # GRUPY
    - name: Grupa - tworzenie 
      group: 
        name: '{{ server_name }}group'
        state: '{{ do_undo }}'

    # UZYTKOWNIK 
    - name: User - tworzenie
      user: 
        name: '{{ user_to_add }}'
        create_home: true
        home: '/home/example_home/{{ user_to_add }}'
        groups: 
          '{{ user_groups }}'
        append: yes
        state: '{{ do_undo }}'
    
    # USLUGI 
    - name: '{{service_name}} - instalacja'
      package: 
        name: '{{service_name}}'
        state: '{{ do_undo }}'
    
    - name: '{{service_name}} - wlaczenie uslugi'
      service: 
        name: '{{service_name}}'
        state: started
        enabled: yes

    - name: 'Firewalld - odblokowanie portu {{ service_port }} dla {{ service_name }}'
      ansible.posix.firewalld:
        state: enabled
        permanent: yes
        immediate: yes
        port: '{{ service_port }}/{{ service_port_protocol }}'
        